---
layout:     post
title:      "浅谈分号之JavaScript ASI"
subtitle:   "JavaScript，ASI"
date:       2017-07-24 00:00
author:     "LanceLou"
header-img: "img/post-JavaScript-ASI.png"
catalog: true
tags:
    - JavaScript
---

> 唉，它不是要寻找幸福，也不是逃避幸福的乐疆！

JavaScript的ASI机制，这个我相信很多人都有遇到，关于JavaScript的经典的书籍也绝对有提到。但真正让我对其萌生兴趣是前些日子组里一同事居然说，在代码打包的时候，由于有人没写分号，所以它的一个立即执行函数无法运行报错。

我想这也是支持写分号的同学常常抛出的一个佐证:

```JavaScript
var foo = function(str){
    console.log(str);
}

(function(){
    foo('123');
})()
```

也即类似于上面的代码，受到JavaScript的ASI机制的某些规则的影响，这将会导致这段代码无法运行。

![ASI_demo_1](https://ws1.sinaimg.cn/large/ad5d774bgy1fhy5kyg1v0j211405374t.jpg)

ASI(automatic semicolon insertion ): 自动分号插入，是JavaScript的一个语法特性，JavaScript语言的执行器能对我们的代码进行分析，并在适当的地方自行插入分号。

## ASI

参考权威指南，我们可以对ASI的相关规则做下概要:

JavaScript解析器并不是在所有换行的地方都填补分号，只有在缺少分号就无法正确解析代码时(相对来说的)，JavaScript解析器才会填补分号。

***通常来讲，如果一条语句以"(","[","/","+","-"开始，那么它极有可能和前一条语句合在一起解析。***

两个例外:

1. 涉及return，break，continue语句的场景中，如果是哪个关键字后面紧跟着换行，JavaScript解释器则会在换行处填补分号。
2. ++，--运算符，其可以作为表达式的前缀，亦可以作为表达式的后缀。***如果将其用作后缀表达式，它和表达式应当在同一行。否则，行尾将填补分号，同时"++"或"--"也会作为下一行代码的前缀操作符并与之一起解析***

这是规则，作为解释器的一种解释规则，我们说，语法层面，语言层面。

当然，这不是本文的全部，却是重点。

下面的链接中，有本文接下来所有描述，或者说总结的点，也是我写这篇文章的初衷，或者说兴趣点:

[JavaScript语句末尾到底该不该加 分号 ?加或不加又有什么区别？比如性能，可读性？](https://github.com/fouber/noop/issues/1)

这是云龙大大git上的一个issues，笔者有幸找到这个issues，可谓收获颇丰！！！

## 工程

其实这时我们会抛出一个问题，在实际开发过程中，是写分号，还是不写分号(最少化分号)呢？二者之间有无好坏之分？

issues中hax老师指出:

> 实际上“可行且更容易”这一结论正是为团队准备的。个人怎么弄其实不是什么大问题。而作为团队规范才要仔细衡量利弊。


hax老师认为，

> 可行且更容易亦即规则更容易记住和实践。如我们不写分号，只需要记住行首特例规则，**反之**都加分号反而需要了解更繁琐的js特例规则，并需要回溯(向前看)代码。比如行末 ```}``` 后面要不要加分号取决于此block是否是函数表达式或对象initializer，如果团队里有人不是那么精通js（比如主要写php/python等偶尔写js的应用工程师），一定都会踩这个坑。另一方面，对于code review的人来说，由于需要回溯代码才能判断要不要加分号，导致效率低和容易漏掉。

膜拜，回朔的一大问题在于我们进行code review时，代价，成本问题。这是关键。

从某种程度上说，写不写分号技术相关性不大，或者说这是一种规范，Style，但其实，这是一种团队开发成本问题，人的问题上，在于观念，而上升到团队问题，我们更多讨论成本，规范，如何更好的，更健康的去开发代码。

> 最困难的是观念上跨出这一步 --myst729

其实这也是我的一个观点，存在即合理，不合理也不会存在。作为技术人，我更喜欢以开放的态度去看待，亦或者接纳技术，技术接触的多，会发现，不存在好与坏，各存在场景，但原理相差无几，这是关键。有是候我们需要从观念上向前看，拥抱开放。


## 总结

其实我并不想标杆我是分号党，亦或是最少分号党，其实，我只是想偷听大佬们关于技术的探讨，理解其中的原因，原理，这是最有趣之处。至于选边站，嗯，。。。容我考虑考虑！！！




